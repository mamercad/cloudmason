---
- name: octodns
  hosts: all
  gather_facts: no

  vars:
    ansible_python_interpreter: /opt/octodns/bin/python

  tasks:

    - name: clone git@github.com:mamercad/cloudmason.git
      git:
        repo: git@github.com:mamercad/cloudmason.git
        dest: /home/awx/src/github.com/mamercad/cloudmason
        accept_hostkey: yes

    - name: do the mo templates
      shell: ../scripts/mo config/letsbuildthe.cloud.yaml.mo | tee config/letsbuildthe.yaml.cloud
      args:
        chdir: /home/awx/src/github.com/mamercad/cloudmason/octodns
      environment:
        eth2: "{{ eth2 }}"

    # - name: octodns-sync
    #   command: /opt/octodns/bin/octodns-sync --config config/production.yaml --doit
    #   args:
    #     chdir: /home/awx/src/github.com/mamercad/cloudmason/octodns
    #   environment:
    #     POWERDNS_API_KEY: "{{ lookup('env', 'POWERDNS_API_KEY') }}"
    #     CLOUDFLARE_API_KEY: "{{ lookup('env', 'CLOUDFLARE_API_KEY') }}"
    #   register: octodns_sync
    #   changed_when: no # Don't care, we'll see the results below

    # - name: show the results of the sync
    #   pause:
    #     seconds: 1
    #     prompt: |
    #       {% for line in octodns_sync.stderr_lines %}
    #       {{ line }}
    #       {% endfor %}
