---

- name: Organization
  awx.awx.tower_organization:
    state: present
    name: Cloudmason
    description: Cloudmason

- name: Team
  awx.awx.tower_team:
    state: present
    name: Cloudmason
    description: Cloudmason
    organization: Cloudmason

- name: Inventory
  awx.awx.tower_inventory:
    state: present
    name: Cloudmason
    description: Cloudmason
    organization: Cloudmason

- name: SCM Credential
  awx.awx.tower_credential:
    state: present
    name: Cloudmason SCM
    description: Cloudmason
    organization: Cloudmason
    credential_type: Source Control
    inputs:
      ssh_key_data: "{{ lookup('file', 'awx.key') }}"
      ssh_key_unlock: !vault |
        $ANSIBLE_VAULT;1.1;AES256
        36626337636262626131396565376435366339626163303031346364353930363430376461373865
        3234303937613636356332656564646261303933363331660a343861636161636133656566636166
        36306233653265626561626365396437623466363537336231383234656161306666336566376461
        6531373065323161660a643039316263643061626439626332376166333462616539373239316563
        3936

- name: Machine Credential
  awx.awx.tower_credential:
    state: present
    name: Cloudmason Machine
    description: Cloudmason
    organization: Cloudmason
    credential_type: Machine
    inputs:
      username: awx
      password: !vault |
        $ANSIBLE_VAULT;1.1;AES256
        36626337636262626131396565376435366339626163303031346364353930363430376461373865
        3234303937613636356332656564646261303933363331660a343861636161636133656566636166
        36306233653265626561626365396437623466363537336231383234656161306666336566376461
        6531373065323161660a643039316263643061626439626332376166333462616539373239316563
        3936
      ssh_key_data: "{{ lookup('file', 'awx.key') }}"
      ssh_key_unlock: !vault |
        $ANSIBLE_VAULT;1.1;AES256
        36626337636262626131396565376435366339626163303031346364353930363430376461373865
        3234303937613636356332656564646261303933363331660a343861636161636133656566636166
        36306233653265626561626365396437623466363537336231383234656161306666336566376461
        6531373065323161660a643039316263643061626439626332376166333462616539373239316563
        3936

- name: Project
  awx.awx.tower_project:
    state: present
    name: Cloudmason
    description: Cloudmason
    organization: Cloudmason
    scm_type: git
    scm_url: git@github.com:mamercad/cloudmason.git
    scm_branch: main
    scm_clean: yes
    scm_delete_on_update: yes
    scm_update_on_launch: yes
    scm_update_cache_timeout: 600
    credential: Cloudmason SCM

- name: Inventory
  awx.awx.tower_inventory:
    state: present
    name: Cloudmason
    description: Cloudmason
    organization: Cloudmason

- name: Inventory Source
  awx.awx.tower_inventory_source:
    state: present
    name: Cloudmason
    description: Cloudmason
    organization: Cloudmason
    inventory: Cloudmason
    source: scm
    source_project: Cloudmason
    source_path: ansible/inventory/cloudmason.yml
    overwrite: yes
    update_cache_timeout: 600
    update_on_project_update: yes

- name: Slack Notification Template
  awx.awx.tower_notification_template:
    name: Slack
    organization: Cloudmason
    notification_type: slack
    notification_configuration:
      channels:
        - awx
      token: !vault |
        $ANSIBLE_VAULT;1.1;AES256
        33643261373439626134336162363733353231636361343439306264663235663136306236363738
        3562366130346337346534316663383566633334333461370a383063623530643766623266313037
        66313332646465366162346332383861393535616365323439633432343331316538363162636537
        3239626663656434360a333763653531383535346138373566393035383233616161393561633538
        63343464386330323863383336373536323436333532363235323233396432396132353235623063
        61373839363565636261646366363633626136646435363037323265363261346538333736353031
        633733363936626263396533336263653865
    messages:
      started:
        message: "{{ '{{ job_friendly_name }}{{ job.id }} started' }}"
      success:
        message: "{{ '{{ job_friendly_name }} completed in {{ job.elapsed }} seconds' }}"
      error:
        message: "{{ '{{ job_friendly_name }} FAILED! Please look at {{ job.url }}' }}"
    state: present

- name: Ping Job Template
  awx.awx.tower_job_template:
    state: present
    name: Ping
    job_type: run
    organization: Cloudmason
    inventory: Cloudmason
    project: Cloudmason
    playbook: ansible/playbooks/ping.yml
    credentials:
      - Cloudmason Machine
    notification_templates_started:
      - Slack
    notification_templates_success:
      - Slack
    notification_templates_error:
      - Slack

- name: Healthchecks.io Job Template
  awx.awx.tower_job_template:
    state: present
    name: Healthchecks.io
    job_type: run
    organization: Cloudmason
    inventory: Cloudmason
    project: Cloudmason
    playbook: ansible/playbooks/healthchecks.io.yml
    credentials:
      - Cloudmason Machine
    notification_templates_started:
      - Slack
    notification_templates_success:
      - Slack
    notification_templates_error:
      - Slack

- name: Pi-hole Job Template
  awx.awx.tower_job_template:
    state: present
    name: Pi-hole
    job_type: run
    organization: Cloudmason
    inventory: Cloudmason
    project: Cloudmason
    playbook: ansible/playbooks/pi-hole.yml
    credentials:
      - Cloudmason Machine
    notification_templates_started:
      - Slack
    notification_templates_success:
      - Slack
    notification_templates_error:
      - Slack
