---
- name: Ensure mark group exists
  group:
    state: present
    name: "{{ group }}"
  become: yes

- name: Ensure mark exists
  user:
    name: "{{ user }}"
    comment: "{{ full_name }}"
    group: "{{ group }}"
    password: !vault |
      $ANSIBLE_VAULT;1.1;AES256
      39643361333563316230306261313132653531383963313438313965633039653139306532366463
      3431373231333837396234326633383365633835326164370a653437646336633839353262343566
      61366532663734343066313932643533343839633333653763386366623361643532623531653034
      3965626238383034330a623561346666636435306330306634323637633237383933643533343034
      36323163366162643065303461613835643135316531386162666364653561666561616434363264
      39633038666238303739626138653762653131373638326264623535303834393033386662346361
      37343932313730366339643731613339316565323862323536623232623966626630333966373061
      33666162626231323935393133363066653037356461626464653135366235323334613562613463
      31623034393034656432313566356334613231366461323733333433323865616331
    create_home: yes
  become: yes

- name: Give mark passwordless sudo
  copy:
    content: mark ALL=(ALL:ALL) NOPASSWD:ALL
    dest: /etc/sudoers.d/mark
    mode: 0440
  become: yes

- name: Deploy ~mark/.ssh/authorized_keys
  copy:
    content: "{{ ssh_authorized_keys }}"
    dest: "{{ home }}/.ssh/authorized_keys"
    owner: "{{ user }}"
    group: "{{ group }}"
    mode: 0644
    backup: yes

- name: Deploy ~mark/.ssh/personal.key.pub
  copy:
    content: "{{ ssh_public_key }}"
    dest: "{{ home }}/.ssh/personal.key.pub"
    owner: "{{ user }}"
    group: "{{ group }}"
    mode: 0444
    backup: yes

- name: Deploy ~mark/.ssh/personal.key
  copy:
    content: "{{ ssh_private_key }}"
    dest: "{{ home }}/.ssh/personal.key"
    owner: "{{ user }}"
    group: "{{ group }}"
    backup: yes

# - name: deploy ~mark/.dotfile
#   template:
#     src: templates/{{ item }}.j2
#     dest: "{{ home }}/.{{ item }}"
#     owner: "{{ user }}"
#     group: "{{ group }}"
#     mode: 0644
#     backup: yes
#   with_items:
#     - bash_profile
#     - inputrc
#     - gitconfig
#     - gitignores
#     - muttrc
#     - screenrc
#     - tmux.conf
#     - vimrc
#     - xbindkeysrc
#     - xinitrc
#     - zshrc
# - name: clone ohmyzsh/ohmyzsh
#   git:
#     repo: https://github.com/ohmyzsh/ohmyzsh.git
#     dest: "{{ home }}/.oh-my-zsh"
#     version: master
# - name: clone gpakosz/tmux
#   git:
#     repo: https://github.com/gpakosz/.tmux.git
#     dest: "{{ home }}/.tmux"
#     version: master
